<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            font-size: 10pt; /* Smaller font for printing */
        }
        .print-header {
            text-align: center;
            margin-bottom: 25px;
            border-bottom: 1px solid #ccc;
            padding-bottom: 15px;
        }
        .print-header h1 {
            margin-bottom: 5px;
            font-size: 16pt;
        }
        .print-header p {
            margin-bottom: 0;
            font-size: 10pt;
            color: #555;
        }
        .day-section {
            margin-bottom: 15px; /* Space between days */
            padding-top: 10px;
            border-top: 1px dotted #eee; /* Light separator */
            page-break-inside: avoid; /* Try to keep day content together */
        }
         .day-section:first-of-type {
            border-top: none; /* No top border for the first day */
        }
        .day-header {
            font-size: 12pt;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .item-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
        }
        .item-table th, .item-table td {
            border: 1px solid #ddd;
            padding: 4px 6px;
            text-align: left;
            vertical-align: top; /* Align content top */
        }
        .item-table th {
            background-color: #f2f2f2;
            font-size: 9pt;
            white-space: nowrap;
        }
        .item-table td {
             font-size: 9pt;
        }
        .item-table .col-equip { width: 25%; }
        .item-table .col-desc { width: 40%; }
        .item-table .col-status { width: 15%; white-space: nowrap;}
        .item-table .col-type { width: 15%; white-space: nowrap;}
        .item-table .col-details { width: 5%; white-space: nowrap; }

        .status-planned { color: #0d6efd; font-weight: bold;} /* Blue */
        .status-completed { color: #198754; font-weight: bold;} /* Green */
        .type-legal { color: #dc3545; } /* Red */
        .type-maint { color: #6c757d; } /* Grey */
        .estimate-tag { font-style: italic; color: #ffc107; } /* Yellow/Orange */

        .sign-off-section {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #000;
            page-break-before: auto; /* Allow page break before sign-off if needed */
             page-break-inside: avoid; /* Keep sign-off block together */
        }
        .sign-off-section h4 {
            text-align: center;
            margin-bottom: 25px;
            font-size: 12pt;
        }
        .sign-off-item {
            margin-bottom: 20px;
            display: flex;
            align-items: flex-end; /* Align label and line */
        }
         .sign-off-item p {
            margin: 0 10px 0 0; /* Space between label and line */
            font-size: 10pt;
            min-width: 60px; /* Ensure labels align nicely */
        }
        .signature-line {
            border-bottom: 1px solid #555;
            flex-grow: 1; /* Line takes remaining space */
            min-height: 1.2em; /* Ensure space for signature */
        }
        .no-items {
             font-style: italic; color: #6c757d; margin-top: 5px; font-size: 9pt;
        }

        @media print {
            body {
                padding: 5mm; /* Reduce padding for print */
                font-size: 9pt; /* Ensure small font for print */
            }
            .btn { display: none; } /* Hide buttons */
            a { text-decoration: none; color: inherit; } /* Make links look like text */
            .item-table th, .item-table td {
                 font-size: 8pt; /* Even smaller for table in print */
                 padding: 3px 4px;
            }
            .day-header { font-size: 11pt; }
            .print-header h1 { font-size: 14pt; }
             .print-header p { font-size: 9pt; }
             .sign-off-section h4 { font-size: 11pt; }
             .sign-off-item p { font-size: 9pt; }
        }
    </style>
</head>
<body>

    <div class="print-header">
        <h1>Maintenance Plan</h1>
        <p>{{ month_name }}</p>
        {% if equipment_type_filter and equipment_type_filter != 'All' %}
        <p>Filtered by Equipment Type: <strong>{{ equipment_type_filter }}</strong></p>
        {% endif %}
    </div>

    {% if daily_plan_data %}
        <table class="item-table">
             <thead>
                <tr>
                    <th class="col-equip">Equipment</th>
                    <th class="col-desc">Task / Job Description</th>
                    <th class="col-status">Status</th>
                    <th class="col-type">Type</th>
                    <th class="col-details">Details</th>
                </tr>
            </thead>
            <tbody>
                {% for day_date, data in daily_plan_data.items() %}
                    {# Optional: Add a row for the date header if desired #}
                    <tr>
                        <td colspan="5" style="background-color: #f8f9fa; font-weight: bold; padding: 5px;">
                           {{ day_date.strftime('%A, %d %B %Y') }}
                        </td>
                    </tr>

                    {# Planned Tasks #}
                    {% if data.planned %}
                        {% for item in data.planned | sort(attribute='equipment.code') %}
                        <tr>
                            <td>{{ item.equipment.code if item.equipment else 'N/A' }} - {{ item.equipment.name if item.equipment else 'N/A' }}</td>
                            <td>{{ item.description }}</td>
                            <td><span class="status-planned">Planned</span></td>
                            <td>
                                {% if item.is_legal %}<span class="type-legal">Legal</span>
                                {% else %}<span class="type-maint">Maintenance</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if item.is_estimate %}<span class="estimate-tag">Est.</span>{% endif %}
                                {{ item.entry.interval_type }}
                            </td>
                        </tr>
                        {% endfor %}
                    {% endif %}

                    {# Completed Jobs #}
                    {% if data.completed %}
                        {% for item in data.completed | sort(attribute='equipment.code') %}
                        <tr>
                            <td>{{ item.equipment.code if item.equipment else 'N/A' }} - {{ item.equipment.name if item.equipment else 'N/A' }}</td>
                            <td>{{ item.description }}</td>
                            <td><span class="status-completed">Completed</span></td>
                            <td>
                                {% if item.is_legal %}<span class="type-legal">Legal</span>
                                {% else %}<span class="type-maint">Maintenance</span>
                                {% endif %}
                            </td>
                            <td>
                                {{ item.job_card.job_number }}<br>
                                ({{ item.job_card.end_datetime.strftime('%H:%M') if item.job_card.end_datetime }})
                            </td>
                        </tr>
                        {% endfor %}
                    {% endif %}

                     {% if not data.planned and not data.completed %}
                         {# This case should technically not happen if the day_date key exists #}
                          <tr><td colspan="5" class="no-items">No items for this day.</td></tr>
                     {% endif %}

                {% endfor %}
            </tbody>
        </table>

    {% else %}
        <p class="no-items">No planned or completed items found for {{ month_name }}
            {% if equipment_type_filter and equipment_type_filter != 'All' %}
             matching filter: <strong>{{ equipment_type_filter }}</strong>
            {% endif %}.
        </p>
    {% endif %}


    {# --- Sign-off Section --- #}
    <div class="sign-off-section">
        <h4>Plan Sign-off</h4>
        <div class="sign-off-item">
            <p>Approved By:</p>
            <div class="signature-line"></div>
        </div>
         <div class="sign-off-item">
            <p>Name:</p>
            <div class="signature-line"></div>
        </div>
         <div class="sign-off-item">
            <p>Date:</p>
            <div class="signature-line"></div>
        </div>
    </div>

</body>
</html>